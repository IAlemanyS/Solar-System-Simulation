% 1 de enero del año 1800
N = 9;

m = [1.988500e30, 3.302E+23, 48.685e23, 5.97219e24, 6.4171e23, 189818722e19, 5.6834e26, 86.813e24, 102.409e24];

w0 = zeros(1, 6 * N);
w0(1) = 5.228565477040853E+05;
w0(2) = -8.694713429460899E+05;
w0(3) = -1.006344787510397E+04;
w0(4) = 1.487301455852110E-02;
w0(5) = 1.821026438460768E-03;
w0(6) = -4.033999989399463E-04;

w0(7) = -3.104484324352735E+07;
w0(8) = 3.660337033910143E+07;
w0(9) = 5.954914973596595E+06;
w0(10) = -4.707720387366800E+01;
w0(11) = -2.939581579050967E+01;
w0(12) = 1.952467466337460E+00;

w0(13) = -9.143099489342408E+07;
w0(14) = 5.448888030418000E+07;
w0(15) = 6.038157181927174E+06;
w0(16) = -1.819264983313854E+01;
w0(17) = -3.017476002618740E+01;
w0(18) = 6.576798702595550E-01;

w0(19) = -3.313915326188036E+07;
w0(20) = 1.423144870279968E+08;
w0(21) = 5.375069134332240E+04;
w0(22) = -2.947529763348513E+01;
w0(23) = -6.933589597050521E+00;
w0(24) = -5.362485157824004E-03;

w0(25) = -1.634767007861486E+08;
w0(26) = -1.668328988150604E+08;
w0(27) = 6.267065569254234E+05;
w0(28) = 1.819416832997657E+01;
w0(29) = -1.497407558419690E+01;
w0(30) = -7.676824462383820E-01;

w0(31) = -3.890766249109606E+06;
w0(32) = 7.669042756704632E+08;
w0(33) = -2.970623912090838E+06;
w0(34) = -1.321324115899137E+01;
w0(35) = 5.372386912656284E-01;
w0(36) = 2.948084180900539E-01;

w0(37) = -8.501069752383999E+08;
w0(38) = 1.062771267416552E+09;
w0(39) = 1.468383844428968E+07;
w0(40) = -8.075190823282805E+00;
w0(41) = -6.055853925641386E+00;
w0(42) = 4.273233263820284E-01;

w0(43) = -2.732804539223057E+09;
w0(44) = 1.459858235369006E+08;
w0(45) = 3.619454226334357E+07;
w0(46) = -4.194282610612186E-01;
w0(47) = -7.115790511181424E+00;
w0(48) = -2.155363216891448E-02;

w0(49) = -3.037845099549026E+09;
w0(50) = -3.365949836618375E+09;
w0(51) = 1.392525530213840E+08;
w0(52) = 4.001340906182666E+00;
w0(53) = -3.610924527962155E+00;
w0(54) = -1.796929497485666E-02;

function res = term(a, x1, y1, z1, b, x2, y2, z2, m2)
  G = 6.67408e-20; %km³/(kg*s²)
  if a == b
    res = 0;
  else
    res = G * m2 * (b - a) / ((x2 - x1) ^ 2 + (y2 - y1) ^ 2 + (z2 - z1) ^ 2) ^ (3 / 2);
  end
end

function res = sumterms(w, i, k, N, m) 
  res = sum(arrayfun (@(j) term(w(6 * i - k), w(6 * i - 5), w(6 * i - 4), w(6 * i - 3), w(6 * j - k), w(6 * j - 5), w(6 * j - 4), w(6 * j - 3), m(j)), [1:N]));
end  

function res = coord(w, i, l, N, m)
  if l > 2
    res = w(6 * i - l + 3);
  else
    res = sumterms(w, i, l + 3, N, m);
  end
end

f = @(t, w) arrayfun(@(s) coord(w, idivide(s - 1, 6) + 1, 5 - mod(s - 1, 6), N, m), [1:6*N]');

[t, w] = mrk4(f, [0, 86400 * 365 * 10], w0, 365 * 10); %del 01-01-1800 al 30-12-1809 (ambos inclusive)

f = fopen('resultado_todos.txt', 'w');
for j = [0:2:16]
  for i = [3 * j + 1, 3 * j + 2, 3 * j + 3]
    fprintf(f, '%d\n', w(:, i));
  end
end
fclose(f);

figure(1);
hold on;
plot3(w(:, 1), w(:, 2), w(:, 3), '-o', 'MarkerSize', 25, 'MarkerEdgeColor', [252 / 256, 165 / 256, 5 / 256], 'MarkerFaceColor', 'y')
plot3(w(:, 7), w(:, 8), w(:, 9), '-o', 'MarkerSize', 2, 'MarkerEdgeColor', [88 / 256, 69 / 256, 57 / 256], 'MarkerFaceColor', [68 / 256, 66 / 256, 59 / 256])
plot3(w(:, 13), w(:, 14), w(:, 15), '-o', 'MarkerSize', 4, 'MarkerEdgeColor', [219 / 256, 111 / 256, 22 / 256], 'MarkerFaceColor', [209 / 256, 121 / 256, 27 / 256])
plot3(w(:, 19), w(:, 20), w(:, 21), '-o', 'MarkerSize', 4, 'MarkerEdgeColor', [4 / 256, 33 / 256, 249 / 256], 'MarkerFaceColor', [14 / 256, 40 / 256, 230 / 256])
plot3(w(:, 25), w(:, 26), w(:, 27), '-o', 'MarkerSize', 3, 'MarkerEdgeColor', [252 / 256, 165 / 256, 5 / 256], 'MarkerFaceColor', [150 / 256, 30 / 256, 30 / 256])
plot3(w(:, 31), w(:, 32), w(:, 33), '-o', 'MarkerSize', 7, 'MarkerEdgeColor', [255 / 256, 204 / 256, 153 / 256], 'MarkerFaceColor', [245 / 256, 214 / 256, 153 / 256])
plot3(w(:, 37), w(:, 38), w(:, 39), '-o', 'MarkerSize', 6, 'MarkerEdgeColor', [255 / 256, 153 / 256, 51 / 256], 'MarkerFaceColor', [245 / 256, 143 / 256, 51 / 256])
plot3(w(:, 43), w(:, 44), w(:, 45), '-o', 'MarkerSize', 5, 'MarkerEdgeColor', [51 / 256, 153 / 256, 255 / 256], 'MarkerFaceColor', [41 / 256, 163 / 256, 245 / 256])
plot3(w(:, 49), w(:, 50), w(:, 51), '-o', 'MarkerSize', 5, 'MarkerEdgeColor', [0 / 256, 0 / 256, 255 / 256], 'MarkerFaceColor', [10 / 256, 10 / 256, 255 / 256])
legend('Sol', 'Mercurio', 'Venus', 'Tierra', 'Marte', 'Júpiter', 'Saturno', 'Urano', 'Neptuno')
%title('Órbitas del Sistema Solar');
hold off;